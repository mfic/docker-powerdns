services:
  pdnsadmin:
    image: pschiffe/pdns-admin:latest
    container_name: pdnsadmin
    restart: unless-stopped
    environment:
      PDNS_ADMIN_SQLA_DB_HOST: ${PDNSADMIN_DB_HOST}
      PDNS_ADMIN_SQLA_DB_PORT: ${PDNSADMIN_DB_PORT}
      PDNS_ADMIN_SQLA_DB_USER: ${PDNSADMIN_DB_USER}
      PDNS_ADMIN_SQLA_DB_PASSWORD: ${PDNSADMIN_DB_PASS}
      PDNS_ADMIN_SQLA_DB_NAME: ${PDNSADMIN_DB}
      PDNS_API_URL: https://${PDNS_MASTER_DOMAIN}/
      PDNS_API_KEY: ${PDNS_API_KEY}
      STRICT_HTTPS: "true"
    labels:
      - traefik.enable=true
      - traefik.docker.network=webproxy
      - traefik.http.routers.pdnsadmin.rule=Host(`${PDNSADMIN_DOMAIN}`)
      - traefik.http.routers.pdnsadmin.entrypoints=websecure
      - traefik.http.routers.pdnsadmin.tls.certresolver=cloudflare
      - traefik.http.services.pdnsadmin.loadbalancer.server.port=8080
    volumes:
      - ./upload:/opt/powerdns-admin/upload
    networks:
      - webproxy

networks:
  webproxy:
    external: true
